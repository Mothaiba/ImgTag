{
    "contents" : "\npLSA_2 <- function(BOW, nTopics, nrep = 20, threshold = 0){\n\n    nImages = nrow(BOW)\n    nWords = ncol(BOW) - 1 #except the category column\n    \n    # p(z|d,w)\n    getP_z_dw <- function(z, d, w){\n        return(p_z[z] * p_d_z[d, z] * p_w_z[w, z] / p_dw[d, w])\n    }\n    \n    # initialize table of p(d,w)\n    p_dw = matrix(nrow = nImages, ncol = nWords)\n    \n    #initialize p(w|z), p(d|z), p(z)\n    p_w_z = matrix(data = runif(nWords * nTopics), nrow = nWords)\n    for(i in 1 : nTopics)\n        p_w_z[, i] = p_w_z[, i] / sum(p_w_z[, i])\n    p_d_z = matrix(data = runif(nImages * nTopics), nrow = nImages)\n    for(i in 1 : nTopics)\n        p_d_z[, i] = p_d_z[, i] / sum(p_d_z[, i])\n    p_z = runif(nTopics)\n    p_z = p_z / sum(p_z)\n    \n    lastLikelihood = 0\n    for(d in 1 : nImages){\n        for(w in 1 : nWords){\n            if(BOW[d, w] == 0)\n                next\n            sum = 0\n            for(z in 1 : nTopics)\n                sum = sum + p_z[z] * p_d_z[d, z] * p_w_z[w, z]\n            p_dw[d, w] = sum\n            lastLikelihood = lastLikelihood + log(sum) * BOW[d, w]\n        }\n    }\n    \n    for(rep in 1 : nrep){\n        \n        #initialize new p(w|z), p(d|z), p(z)\n        p2_w_z = matrix(data = 0, nrow = nWords, ncol = nTopics)\n        p2_d_z = matrix(data = 0, nrow = nImages, ncol = nTopics)\n        p2_z = matrix(data = rep(0, nTopics))\n        \n        for(d in 1 : nImages){\n            for(w in 1 : nWords){\n                if(BOW[d, w] == 0)\n                    next\n                for(z in 1 : nTopics){\n                    addition = BOW[d, w] * getP_z_dw(z, d, w)\n                    p2_w_z[w, z] = p2_w_z[w, z] + addition\n                    p2_d_z[d, z] = p2_d_z[d, z] + addition\n                    p2_z[z] = p2_z[z] + addition\n                }\n            }\n        }\n        \n        for(z in 1 : nTopics){\n            p2_w_z[, z] = p2_w_z[, z] / sum(p2_w_z[, z])\n            p2_d_z[, z] = p2_d_z[, z] / sum(p2_d_z[, z])   \n        }\n        p2_z = p2_z / sum(p2_z)\n        \n        p_w_z = p2_w_z\n        p_d_z = p2_d_z\n        p_z = p2_z\n        \n        # calculate log likelihook and compare with threshold\n        likelihood = 0\n        for(d in 1 : nImages){\n            for(w in 1 : nWords){\n                if(BOW[d, w] == 0)\n                    next\n                sum = 0\n                for(z in 1 : nTopics)\n                    sum = sum + p_z[z] * p_d_z[d, z] * p_w_z[w, z]\n                p_dw[d, w] = sum\n                likelihood = likelihood + log(sum) * BOW[d, w]\n            }\n        }\n        \n        delta = likelihood - lastLikelihood\n        print('Delta log likelihood: ')\n        print(delta)\n        \n        if(delta < threshold)\n            break\n        \n        lastLikelihood = likelihood\n        \n    }\n    \n    # return p(z|d)\n    p_z_d = matrix(ncol = nTopics, nrow = nImages)\n    for(d in 1 : nImages)\n        for(z in 1 : nTopics)\n            p_z_d[d, z] = p_d_z[d, z] * p_z[z]\n    \n    return(data.frame(p_z_d))\n    \n}\n\n\n\nnTopics = 50\ndatasets = c('Corel1000', 'MIT8', 'Caltech101')\n\nfor(dataset in datasets){\n    print(dataset)\n    link = paste('../BOW/', dataset, '.csv', sep = '')\n    BOW = read.csv(link)\n    \n    pLSA = pLSA_2(BOW, nTopics)\n    pLSA = cbind(pLSA, BOW$target)\n    \n    write.csv(pLSA, file = paste('../pLSA_2/', dataset, '.csv', sep = ''), row.names = F )\n}\n",
    "created" : 1452753781628.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4133270240",
    "id" : "8E7AF0B",
    "lastKnownWriteTime" : 1452948629,
    "path" : "E:/Courses/Final Project/W6/R_codes/pLSA_2.R",
    "project_path" : "pLSA_2.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}